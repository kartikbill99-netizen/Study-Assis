<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>AI Study Assistant</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="min-h-screen bg-gradient-to-b from-gray-50 to-white flex flex-col">

  <!-- Header -->
  <header class="bg-white border-b border-gray-200 sticky top-0 z-50 shadow-sm">
    <div class="max-w-4xl mx-auto px-6 py-5 text-center">
      <h1 class="text-3xl font-extrabold text-gray-900">AI Study Assistant</h1>
      <p class="text-sm text-gray-600 mt-1 italic">"Education is the most powerful weapon you can use to change the world." üìö‚ú®</p>
    </div>
  </header>

  <!-- Main -->
  <main class="flex-1 max-w-4xl mx-auto w-full px-6 py-8">
    <!-- Chat input -->
    <div class="bg-white rounded-2xl shadow-lg border border-gray-200 p-6 mb-6">
      <div class="flex gap-3 items-center">
        <input id="aiInput" type="text" placeholder="Ask me anything..." 
               class="flex-1 px-4 py-3 border-2 border-gray-300 rounded-lg focus:outline-none focus:border-amber-500 transition-all" />
        <button id="sendBtn" class="px-5 py-3 bg-gradient-to-r from-amber-400 to-orange-500 text-white font-semibold rounded-lg hover:shadow-lg transition-all">
          Send
        </button>
      </div>
      <p id="hint" class="text-xs text-gray-500 mt-2">Press Enter to send ¬∑ Powered by Gemini (backend)</p>
    </div>

    <!-- Messages -->
    <div id="messages" class="bg-white rounded-2xl shadow-lg border border-gray-200 p-6 max-h-[520px] overflow-y-auto space-y-4">
      <!-- chat messages will be appended here -->
      <div id="welcome" class="text-center text-gray-600">
        <p class="font-semibold">Welcome ‚Äî try a question like:</p>
        <p class="text-sm mt-2">"Explain photosynthesis step by step" ¬∑ "How to solve quadratic equations?"</p>
      </div>
    </div>

    <!-- Quality / Differentiators -->
    <section class="mt-8 bg-gradient-to-br from-amber-50 to-orange-50 rounded-2xl p-6 border-2 border-amber-200">
      <h2 class="text-2xl font-bold text-gray-900 mb-4">Why this assistant is different</h2>
      <ul class="list-disc list-inside text-gray-700 space-y-2">
        <li>üöÄ Real-time AI responses ‚Äî fast and focused.</li>
        <li>üìö Step-by-step explanations ‚Äî we teach the method, not just the answer.</li>
        <li>üîí API keys never exposed to browsers ‚Äî backend-only access.</li>
        <li>‚ú® Lightweight, distraction-free UI ‚Äî built for students.</li>
      </ul>
    </section>
  </main>

  <footer class="bg-gradient-to-r from-amber-50 to-orange-50 border-t border-amber-200 py-6 text-center text-gray-600">
    ¬© 2025 AI Study Assistant ‚Ä¢ All Rights Reserved
  </footer>

  <script>
    const input = document.getElementById('aiInput');
    const sendBtn = document.getElementById('sendBtn');
    const messages = document.getElementById('messages');
    const welcome = document.getElementById('welcome');

    let loading = false;

    function appendMessage({ from = 'ai', title = '', emoji = '', text = '' }) {
      // remove welcome on first message
      if (welcome) { welcome.remove(); }

      const wrapper = document.createElement('div');
      wrapper.className = from === 'user' ? 'flex justify-end' : 'flex justify-start';

      const bubble = document.createElement('div');
      bubble.className = from === 'user'
        ? 'max-w-[80%] rounded-2xl p-4 bg-gradient-to-r from-amber-500 to-orange-500 text-white'
        : 'max-w-[80%] rounded-2xl p-4 bg-gray-100 text-gray-900 border border-gray-200';

      // For AI include title + emoji
      if (from === 'ai') {
        bubble.innerHTML = `<strong>${title} ${emoji}</strong><br><div class="mt-2 whitespace-pre-wrap">${escapeHtml(text)}</div>`;
      } else {
        bubble.textContent = text;
      }

      wrapper.appendChild(bubble);
      messages.appendChild(wrapper);
      messages.scrollTop = messages.scrollHeight;
    }

    // simple HTML-escape to avoid injection
    function escapeHtml(unsafe) {
      if (!unsafe) return '';
      return unsafe
        .replaceAll('&', '&amp;')
        .replaceAll('<', '&lt;')
        .replaceAll('>', '&gt;')
        .replaceAll('"', '&quot;')
        .replaceAll("'", '&#039;');
    }

    async function sendPrompt() {
      if (loading) return;
      const prompt = input.value.trim();
      if (!prompt) return;

      // show user bubble
      appendMessage({ from: 'user', text: prompt });
      input.value = '';
      input.focus();

      // show temporary "thinking" bubble
      const thinking = document.createElement('div');
      thinking.className = 'flex justify-start';
      thinking.innerHTML = `<div class="max-w-[80%] rounded-2xl p-4 bg-gray-100 text-gray-700 border border-gray-200">‚è≥ Thinking...</div>`;
      messages.appendChild(thinking);
      messages.scrollTop = messages.scrollHeight;

      loading = true;
      input.disabled = true;
      sendBtn.disabled = true;

      try {
        const resp = await fetch('/api/gemini', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ prompt })
        });

        const data = await resp.json();
        // remove thinking bubble
        thinking.remove();

        if (!resp.ok) {
          appendMessage({ from: 'ai', title: 'Error', emoji: '‚ö†Ô∏è', text: data?.error || 'Unknown error' });
        } else {
          // ensure fields exist
          const title = data.title || 'AI Study Assistant';
          const emoji = data.emoji || '‚ú®';
          const reply = data.reply || 'No reply from model.';
          appendMessage({ from: 'ai', title, emoji, text: reply });
        }
      } catch (err) {
        // remove thinking bubble
        thinking.remove();
        appendMessage({ from: 'ai', title: 'Error', emoji: '‚ö†Ô∏è', text: 'Network error: could not reach server.' });
        console.error('Network error:', err);
      } finally {
        loading = false;
        input.disabled = false;
        sendBtn.disabled = false;
        input.focus();
      }
    }

    // handlers
    sendBtn.addEventListener('click', sendPrompt);
    input.addEventListener('keydown', (e) => {
      if (e.key === 'Enter') sendPrompt();
    });

    // enable keyboard focus on load
    input.disabled = false;
    input.focus();
  </script>
</body>
</html>
